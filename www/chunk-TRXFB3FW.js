import{a as ie}from"./chunk-JVIVCWCT.js";import{a as ne}from"./chunk-SP2N6BLA.js";import{b as te}from"./chunk-TRJ775NK.js";import{$a as $,A as u,Aa as H,B as d,Ba as q,C as g,L as E,La as J,Ma as K,O as G,Oa as Q,Pa as X,S as A,Sa as Y,Ua as Z,Z as W,_ as O,ba as x,da as T,ea as F,fb as ee,g as M,ga as k,h as P,j as l,k as h,l as v,m as C,n as _,o,oa as R,p as a,q as D,qa as B,r as N,ra as L,s as b,sa as j,ua as z,va as U,w as m,wa as V,x as S,y as I}from"./chunk-6RAZA6VU.js";import"./chunk-AW7IZUNH.js";import"./chunk-QUJFQN2Y.js";import"./chunk-4SQRGWZO.js";import"./chunk-AGW4ECHM.js";import"./chunk-FHFIUQVW.js";import"./chunk-4QUK7M54.js";import"./chunk-KEPJZG4G.js";import"./chunk-J4TEZE7G.js";import"./chunk-WI6SOTL5.js";import"./chunk-QNCTVU3D.js";import"./chunk-KYMKABGL.js";import"./chunk-44WLN7XP.js";import"./chunk-IZQDRDWN.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-H7IJB4EE.js";import"./chunk-CKP3SGE2.js";import"./chunk-BVXZQL7V.js";import"./chunk-26IOXOZM.js";import"./chunk-EQZVBGP4.js";import"./chunk-NPYKXPTT.js";import"./chunk-LSNLUNBJ.js";import"./chunk-DNTR6X5U.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-G7SWQJ6W.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{h as p}from"./chunk-B7O3QC5Z.js";function oe(c,s){if(c&1&&(o(0,"ion-select-option",23),m(1),a()),c&2){let f=s.$implicit;_("value",f.id),l(),I(" ",f.name," ")}}function ae(c,s){if(c&1){let f=N();o(0,"ion-row",24)(1,"ion-col",25)(2,"div",26),m(3),a()(),o(4,"ion-col",27)(5,"ion-input",28),g("ngModelChange",function(t){let e=M(f).$implicit;return d(e.name,t)||(e.name=t),P(t)}),a(),o(6,"ion-input",29),g("ngModelChange",function(t){let e=M(f).$implicit;return d(e.mobile,t)||(e.mobile=t),P(t)}),a()()()}if(c&2){let f=s.$implicit,i=s.index;l(3),S(i+1),l(2),u("ngModel",f.name),l(),u("ngModel",f.mobile)}}var be=(()=>{let s=class s{constructor(i,t,e,r,n,w,y){this.pubServ=i,this.navCtrl=t,this.alertCtrl=e,this.userServ=r,this.activatedRoute=n,this.uploadServ=w,this.myhttp=y,this.formData={},this.programs=[],this.members=[],this.totalGroupPaidAmount=0,this.upiId="yourupi@upi",this.receiverName="Sabka Vikas Jyoti",this.utr="",this.paymentDone=!1}ngOnInit(){return p(this,null,function*(){this.activatedRoute.paramMap.subscribe(i=>p(this,null,function*(){this.groupId=i.get("groupId");let t=yield this.userServ.getProfile();if(this.formData.ep_no=t.volntr_ep_temp,this.programs=yield this.pubServ.getPrograms(),this.groupId){let e=yield this.pubServ.getGroup(this.groupId);e&&(this.formData=e.groupdata||{},this.members=e.members||[],this.formData.no_of_members=this.members.length)}}))})}onNoOfMembersChange(){let i=Number(this.formData?.no_of_members)||0;if(this.members||(this.members=[]),i>this.members.length)for(let t=this.members.length;t<i;t++)this.members.push({name:"",mobile:""});else i<this.members.length&&this.members.splice(i);this.totalGroupPaidAmount=(this.formData?.no_of_members||0)*225}onFileChange(i){let t=i.target?.files&&i.target.files[0];t&&(this.paymentScreenshot=t)}payNow(){if(this.totalGroupPaidAmount<=0){this.showAlert("Invalid amount");return}let i=`GROUP_${this.formData.group_name||"NEW"}`,t=`upi://pay?pa=${this.upiId}&pn=${encodeURIComponent(this.receiverName)}&am=${this.totalGroupPaidAmount}&cu=INR&tn=${encodeURIComponent(i)}`;window.location.href=t}selectImage(i){return p(this,null,function*(){let t=document.createElement("input");t.setAttribute("type","file"),t.click(),t.addEventListener("change",e=>p(this,null,function*(){yield this.uploadimage(e)}))})}uploadimage(i){return p(this,null,function*(){let e=i.target.files;if(!(!e||e.length===0))for(let r=0;r<e.length;r++){let w={file_upload:e[r],upload_type:"misc"},y=yield this.uploadServ.uploadImage(w);y?this.formData.proofimage=y.imgValue:yield this.imageshowAlert("Error","Image not uploaded.")}})}imageshowAlert(i,t){return p(this,null,function*(){yield(yield this.alertCtrl.create({header:i,message:t,buttons:["OK"]})).present()})}submitPaymentProof(){return p(this,null,function*(){if(!this.utr||!this.paymentScreenshot){yield this.showAlert("UTR number and screenshot are required");return}let i=new FormData;i.append("group_name",this.formData.group_name),i.append("amount",this.totalGroupPaidAmount.toString()),i.append("utr",this.utr),i.append("screenshot",this.paymentScreenshot);let t=yield this.userServ.saveGroupPayment(i);t?.status?(this.paymentDone=!0,yield this.showAlert("Payment submitted. Verification pending.")):yield this.showAlert(t?.msg||"Payment failed")})}saveGroup(){return p(this,null,function*(){if(!this.formData?.group_name){yield this.showAlert("Group name is required");return}if(!this.formData?.program_id){yield this.showAlert("Please select a Program.");return}if(!this.formData?.ep_no||!this.formData?.senior_ep_no){yield this.showAlert("Please enter both EP No and Senior EP No.");return}if(Number(this.formData?.no_of_members??0)<12){yield this.showAlert("Please add at least 10 members.");return}let t=this.members??[];for(let r=0;r<t.length;r++){let n=t[r];if(!n?.name||!n.name.trim()){yield this.showAlert(`Please enter a name for member ${r+1}.`);return}if(!n?.mobile||!n.mobile.trim()){yield this.showAlert(`Please enter a mobile number for member ${r+1}.`);return}if(!/^\d{10}$/.test(n.mobile)){yield this.showAlert(`Mobile number for member ${r+1} must be 10 digits.`);return}}this.groupId&&(this.formData.group_id=this.groupId),this.formData.members=JSON.stringify(t);let e=yield this.userServ.createGroup(this.formData);e?.status?this.navCtrl.navigateForward(["/groups"]):yield this.showAlert(e?.msg||"Group creation failed.")})}showAlert(i){return p(this,null,function*(){yield(yield this.alertCtrl.create({header:"Notice",message:i,buttons:["OK"]})).present()})}};s.\u0275fac=function(t){return new(t||s)(h(ne),h(k),h($),h(te),h(A),h(ie),h(ee))},s.\u0275cmp=v({type:s,selectors:[["app-new-group"]],inputs:{groupId:"groupId"},decls:60,vars:13,consts:[[3,"translucent"],[1,"ion-padding",3,"fullscreen"],[1,"amount-card"],[1,"amount-header"],[1,"per-member"],[1,"calc-box"],[1,"left"],[1,"right"],[1,"total-amount"],["labelPlacement","floating","label","UTR Number","fill","outline",3,"ngModelChange","ngModel"],["type","file","accept","image/*","fill","outline",1,"ion-margin-top",3,"change"],["expand","block",1,"ion-margin-top",3,"click"],["size","12"],["labelPlacement","floating","label","Group Name","fill","outline","type","text",3,"ngModelChange","ngModel"],["labelPlacement","floating","label","Program","fill","outline",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["labelPlacement","floating","label","Ep No","fill","outline","type","text",3,"ngModelChange","ngModel"],["labelPlacement","floating","label","Senior Ep No","fill","outline","type","text",3,"ngModelChange","ngModel"],["labelPlacement","floating","label","Start Date","fill","outline","type","date",3,"ngModelChange","ngModel"],["maxlength","2","labelPlacement","floating","label","No of Members","fill","outline","type","number",3,"ionInput","ngModelChange","ngModel"],[1,"ion-margin-top"],["class","ion-align-items-start",4,"ngFor","ngForOf"],["expand","block","type","submit",1,"ion-margin-top",3,"click"],[3,"value"],[1,"ion-align-items-start"],["size","1",1,"ion-text-center"],[1,"member-counter"],["size","11"],["labelPlacement","floating","label","Member Name","fill","outline",3,"ngModelChange","ngModel"],["maxlength","10","labelPlacement","floating","label","Mobile","type","tel","fill","outline",1,"ion-margin-top",3,"ngModelChange","ngModel"]],template:function(t,e){t&1&&(o(0,"ion-header",0)(1,"ion-toolbar"),D(2,"ion-title"),a()(),o(3,"ion-content",1)(4,"ion-card",2)(5,"ion-card-content")(6,"div",3)(7,"h2"),m(8,"Registration Amount"),a(),o(9,"span",4),m(10,"\u20B9 225 / Member"),a()(),o(11,"div",5)(12,"div",6)(13,"p"),m(14,"No. of Members:"),a(),o(15,"h3"),m(16),a()(),o(17,"div",7)(18,"p"),m(19,"Total Amount:"),a(),o(20,"h2",8),m(21),a()()()()(),o(22,"ion-card")(23,"ion-card-header")(24,"ion-card-title"),m(25,"Payment Proof"),a()(),o(26,"ion-card-content")(27,"ion-input",9),g("ngModelChange",function(n){return d(e.utr,n)||(e.utr=n),n}),a(),o(28,"ion-input",10),b("change",function(n){return e.onFileChange(n)}),a(),o(29,"ion-button",11),b("click",function(){return e.submitPaymentProof()}),m(30," Submit Payment Proof "),a()()(),o(31,"ion-card")(32,"ion-card-header")(33,"ion-card-title"),m(34,"Create New Group"),a()(),o(35,"ion-card-content")(36,"ion-grid")(37,"ion-row")(38,"ion-col",12)(39,"ion-input",13),g("ngModelChange",function(n){return d(e.formData.group_name,n)||(e.formData.group_name=n),n}),a()(),o(40,"ion-col",12)(41,"ion-select",14),g("ngModelChange",function(n){return d(e.formData.program_id,n)||(e.formData.program_id=n),n}),C(42,oe,2,2,"ion-select-option",15),a()(),o(43,"ion-col",12)(44,"ion-input",16),g("ngModelChange",function(n){return d(e.formData.ep_no,n)||(e.formData.ep_no=n),n}),a()(),o(45,"ion-col",12)(46,"ion-input",17),g("ngModelChange",function(n){return d(e.formData.senior_ep_no,n)||(e.formData.senior_ep_no=n),n}),a()(),o(47,"ion-col",12)(48,"ion-input",18),g("ngModelChange",function(n){return d(e.formData.group_start_date,n)||(e.formData.group_start_date=n),n}),a()(),o(49,"ion-col",12)(50,"ion-input",19),b("ionInput",function(){return e.onNoOfMembersChange()}),g("ngModelChange",function(n){return d(e.formData.no_of_members,n)||(e.formData.no_of_members=n),n}),a()()(),o(51,"ion-row")(52,"ion-col",12)(53,"ion-title",20),m(54,"Group Members"),a()()(),C(55,ae,7,3,"ion-row",21),o(56,"ion-row")(57,"ion-col",12)(58,"ion-button",22),b("click",function(){return e.saveGroup()}),m(59," Save Group "),a()()()()()()()),t&2&&(_("translucent",!0),l(3),_("fullscreen",!0),l(13),S(e.formData.no_of_members||0),l(5),I("\u20B9 ",e.totalGroupPaidAmount),l(6),u("ngModel",e.utr),l(12),u("ngModel",e.formData.group_name),l(2),u("ngModel",e.formData.program_id),l(),_("ngForOf",e.programs),l(2),u("ngModel",e.formData.ep_no),l(2),u("ngModel",e.formData.senior_ep_no),l(2),u("ngModel",e.formData.group_start_date),l(2),u("ngModel",e.formData.no_of_members),l(5),_("ngForOf",e.members))},dependencies:[R,U,V,H,q,Y,J,Q,X,B,j,L,z,G,E,F,W,x,Z,K,T,O],styles:[".member-counter[_ngcontent-%COMP%]{width:25px;height:25px;background-color:#3880ff;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1rem;margin-left:-15px;margin-top:10px}.amount-card[_ngcontent-%COMP%]{border-left:6px solid #ff9800;border-radius:12px;background:#fffaf0}.amount-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.amount-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:700}.per-member[_ngcontent-%COMP%]{background:#ff9800;color:#fff;padding:4px 10px;border-radius:20px;font-size:14px;font-weight:600}.calc-box[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:space-between;background:#fff3d4;padding:14px;border-radius:12px}.calc-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#444;font-size:14px}.calc-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:4px 0 0;font-size:18px;font-weight:600}.total-amount[_ngcontent-%COMP%]{margin:4px 0 0;font-size:22px;font-weight:700;color:#e65100}"]});let c=s;return c})();export{be as NewGroupPage};
