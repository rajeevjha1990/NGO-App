import{a as le}from"./chunk-SP2N6BLA.js";import{$a as se,Ba as Z,Ca as ee,Da as te,F as E,G as F,Ga as ie,H as P,I as O,J as A,K as R,L,M as B,N,Na as ne,O as V,Oa as oe,Pa as ae,Ra as re,S as Y,V as j,da as z,ea as H,g as y,h as D,j as l,k as f,l as v,m as g,n as d,na as $,o as s,oa as K,p as r,q as b,qa as U,r as C,s as S,sa as W,t as h,ta as q,u as M,ua as G,w as _,wa as J,xa as Q,y as T,ya as X,z as k}from"./chunk-6RAZA6VU.js";import"./chunk-AW7IZUNH.js";import"./chunk-QUJFQN2Y.js";import"./chunk-4SQRGWZO.js";import"./chunk-AGW4ECHM.js";import"./chunk-FHFIUQVW.js";import"./chunk-4QUK7M54.js";import"./chunk-KEPJZG4G.js";import"./chunk-J4TEZE7G.js";import"./chunk-WI6SOTL5.js";import"./chunk-QNCTVU3D.js";import"./chunk-KYMKABGL.js";import"./chunk-44WLN7XP.js";import"./chunk-IZQDRDWN.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-H7IJB4EE.js";import"./chunk-CKP3SGE2.js";import"./chunk-BVXZQL7V.js";import"./chunk-26IOXOZM.js";import"./chunk-EQZVBGP4.js";import"./chunk-NPYKXPTT.js";import"./chunk-LSNLUNBJ.js";import"./chunk-DNTR6X5U.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-G7SWQJ6W.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{h as m}from"./chunk-B7O3QC5Z.js";var de=i=>({"due-today":i});function ce(i,n){i&1&&(s(0,"ion-badge",14),_(1," Due Now "),r())}function ue(i,n){if(i&1){let o=C();s(0,"ion-button",15),S("click",function(){y(o);let t=h().$implicit,a=h(2);return D(a.reIssue(t))}),_(1," Re-Issue Pad "),r()}}function _e(i,n){if(i&1&&(s(0,"ion-card",11)(1,"ion-card-header")(2,"ion-card-title"),_(3),g(4,ce,2,0,"ion-badge",12),r(),s(5,"ion-card-subtitle"),_(6),F(7,"date"),r(),g(8,ue,2,0,"ion-button",13),r()()),i&2){let o=n.$implicit;d("ngClass",E(9,de,o.is_due_today)),l(3),k(" ",o.member_name," (",o.mobile,") "),l(),d("ngIf",o.is_due_today),l(2),T(" Last Issue: ",P(7,6,o.issue_date,"mediumDate")," "),l(2),d("ngIf",o.is_due_today)}}function pe(i,n){if(i&1&&(s(0,"ion-list"),g(1,_e,9,11,"ion-card",10),r()),i&2){let o=h();l(),d("ngForOf",o.distributedsaintries)("ngForTrackBy",o.trackById)}}function me(i,n){if(i&1){let o=C();s(0,"ion-infinite-scroll",16),S("ionInfinite",function(t){y(o);let a=h();return D(a.loadData(t))}),b(1,"ion-infinite-scroll-content",17),r()}}function fe(i,n){i&1&&(s(0,"ion-text",18)(1,"p"),_(2,"No records found."),r()())}var ve=(()=>{let n=class n{constructor(e,t,a,u){this.pubServ=e,this.alertCtrl=t,this.route=a,this.cdr=u,this.distributedsaintries=[],this.dueTodayCount=0,this.page=1,this.limit=20,this.hasMoreData=!0,this.loading=!1}ngOnInit(){}ionViewWillEnter(){return m(this,null,function*(){yield this.resetAndLoad(),this.cdr.markForCheck()})}resetAndLoad(){return m(this,null,function*(){this.page=1,this.hasMoreData=!0,this.distributedsaintries=[],yield this.loadData()})}loadData(e){return m(this,null,function*(){if(this.loading||!this.hasMoreData)return;this.loading=!0;let t=yield this.pubServ.allDistributedSaintri(this.page,this.limit);t.length<this.limit&&(this.hasMoreData=!1),this.distributedsaintries.push(...t),this.calculateTodayDue(),this.page++,this.loading=!1,e&&e.target.complete()})}trackById(e,t){return t.id}calculateTodayDue(){let e=new Date;this.dueTodayCount=0,this.distributedsaintries.forEach(t=>{if(!t.issue_date){t.is_due_today=!1;return}let[a,u,w]=t.issue_date.split("-").map(Number),c=new Date(a,u-1,w),I,x;if(c.getDate()>=1&&c.getDate()<=25)I=new Date(c.getFullYear(),c.getMonth(),20),x=new Date(c.getFullYear(),c.getMonth(),30);else{let p=new Date(c);p.setMonth(p.getMonth()+1),I=new Date(p.getFullYear(),p.getMonth(),25),x=new Date(p.getFullYear(),p.getMonth(),30)}t.is_due_today=e>=I&&e<=x&&(t.status==1||t.status=="1"),t.is_due_today&&this.dueTodayCount++})}reIssue(e){return m(this,null,function*(){yield(yield this.alertCtrl.create({header:"Confirm Re-Issue",message:"Are you sure you want to re-issue this plan?",buttons:[{text:"Cancel",role:"cancel"},{text:"Yes, Re-Issue",handler:()=>m(this,null,function*(){let a=new Date().toISOString().slice(0,10),u={id:e.id,volunteer_id:e.volunteer_id,reissue_date:a,member_name:e.member_name,age:e.age,guardian:e.guardian,village:e.village,post:e.post,police_station:e.police_station,district:e.district,state:e.state,pincode:e.pincode,aadhar:e.aadhar,mobile:e.mobile,membership_amount:e.membership_amount};(yield this.pubServ.reIssuePad(u))?.status==200&&(yield this.resetAndLoad(),yield(yield this.alertCtrl.create({header:"Success",message:"Re-Issue Successful",buttons:["OK"]})).present())})}]})).present()})}};n.\u0275fac=function(t){return new(t||n)(f(le),f(se),f(Y),f(A))},n.\u0275cmp=v({type:n,selectors:[["app-distributed-saintries"]],decls:13,vars:5,consts:[["noData",""],[3,"translucent"],["color","primary"],[1,"ion-padding",3,"fullscreen"],[2,"text-align","center"],[4,"ngIf","ngIfElse"],["threshold","100px",3,"ionInfinite",4,"ngIf"],["horizontal","end","vertical","bottom","slot","fixed","routerLink","/new-distribution"],["color","success"],["name","add-outline"],[3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngClass"],["color","danger",4,"ngIf"],["color","warning","size","small","expand","block",3,"click",4,"ngIf"],["color","danger"],["color","warning","size","small","expand","block",3,"click"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading more records..."],["color","medium",1,"ion-text-center"]],template:function(t,a){if(t&1&&(s(0,"ion-header",1)(1,"ion-toolbar",2),b(2,"ion-title"),r()(),s(3,"ion-content",3)(4,"h1",4),_(5,"Distributed Saintries"),r(),g(6,pe,2,2,"ion-list",5)(7,me,2,0,"ion-infinite-scroll",6)(8,fe,3,0,"ng-template",null,0,O),s(10,"ion-fab",7)(11,"ion-fab-button",8),b(12,"ion-icon",9),r()()()),t&2){let u=M(9);d("translucent",!0),l(3),d("fullscreen",!0),l(3),d("ngIf",a.distributedsaintries.length>0)("ngIfElse",u),l(),d("ngIf",a.hasMoreData)}},dependencies:[V,R,L,B,K,J,Z,re,ie,oe,ae,U,W,G,ne,H,$,q,Q,X,z,ee,te,j,N],styles:[".due-today[_ngcontent-%COMP%]{border-left:6px solid #eb445a;background:#fff1f1;box-shadow:0 0 12px #eb445a66}ion-card.due-today[_ngcontent-%COMP%]{border:3px solid red;background:#fff1f1;animation:_ngcontent-%COMP%_blink 1s infinite}@keyframes _ngcontent-%COMP%_blink{0%{box-shadow:0 0 5px red}50%{box-shadow:0 0 15px red}to{box-shadow:0 0 5px red}}"],changeDetection:0});let i=n;return i})();export{ve as DistributedSaintriesPage};
