import{b as P}from"./chunk-TRJ775NK.js";import{$a as $,A as h,Aa as U,B as u,Ba as G,C as x,Ka as K,La as Y,M as S,O as T,Oa as J,Pa as Q,Sa as X,Ta as Z,U as V,Z as O,_ as k,aa as E,ba as F,ca as W,da as R,ea as A,g as p,h as m,j as s,k as g,l as y,m as C,n as _,o as a,oa as L,p as n,q as v,qa as N,r as b,ra as j,s as f,sa as z,t as l,ua as B,va as q,w as d,wa as H,x as I,y as M,z as D}from"./chunk-6RAZA6VU.js";import"./chunk-AW7IZUNH.js";import"./chunk-QUJFQN2Y.js";import"./chunk-4SQRGWZO.js";import"./chunk-AGW4ECHM.js";import"./chunk-FHFIUQVW.js";import"./chunk-4QUK7M54.js";import"./chunk-KEPJZG4G.js";import"./chunk-J4TEZE7G.js";import"./chunk-WI6SOTL5.js";import"./chunk-QNCTVU3D.js";import"./chunk-KYMKABGL.js";import"./chunk-44WLN7XP.js";import"./chunk-IZQDRDWN.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-H7IJB4EE.js";import"./chunk-CKP3SGE2.js";import"./chunk-BVXZQL7V.js";import"./chunk-26IOXOZM.js";import"./chunk-EQZVBGP4.js";import"./chunk-NPYKXPTT.js";import"./chunk-LSNLUNBJ.js";import"./chunk-DNTR6X5U.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-G7SWQJ6W.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{h as w}from"./chunk-B7O3QC5Z.js";function te(r,c){if(r&1){let t=b();a(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),d(3," Reset your new password "),n()(),a(4,"ion-card-content")(5,"div")(6,"ion-col",3)(7,"ion-input",4),x("ngModelChange",function(e){p(t);let o=l();return u(o.formData.mobile,e)||(o.formData.mobile=e),m(e)}),f("ionChange",function(e){p(t);let o=l();return m(o.sanitizeMobile(e))}),n()(),a(8,"ion-button",5),f("click",function(){p(t);let e=l();return m(e.submit())}),d(9,"Submit"),n()()()()}if(r&2){let t=l();s(7),h("ngModel",t.formData.mobile)}}function ie(r,c){if(r&1){let t=b();a(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title")(3,"h2",6),d(4,"Verify Your Account"),n()()(),a(5,"ion-card-content")(6,"ion-grid")(7,"ion-row")(8,"ion-col",3)(9,"ion-input-otp",7),x("ngModelChange",function(e){p(t);let o=l();return u(o.otpCode,e)||(o.otpCode=e),m(e)}),n()()(),a(10,"ion-row")(11,"ion-col",8)(12,"p",9),d(13),n(),a(14,"p",9),d(15),n()()(),a(16,"ion-row")(17,"ion-col",3)(18,"ion-button",10),f("click",function(){p(t);let e=l();return m(e.verifyOtp())}),d(19,"Verify OTP"),n()()()()()()}if(r&2){let t=l();s(9),_("length",4),h("ngModel",t.otpCode),s(4),D(" OTP sent to ",t.formData.mobile,". Please enter the OTP ",t.otpData.otp,". "),s(2),M(" OTP expires in: ",t.otpTimer," seconds ")}}function oe(r,c){if(r&1&&(a(0,"ion-note",14),d(1),n()),r&2){let t=l(2);s(),I(t.errors.new_password)}}function ne(r,c){if(r&1&&(a(0,"ion-note",14),d(1),n()),r&2){let t=l(2);s(),I(t.errors.confirm_password)}}function re(r,c){if(r&1){let t=b();a(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),d(3,"Reset your password"),n()(),a(4,"ion-card-content")(5,"ion-grid")(6,"ion-row")(7,"ion-col",3)(8,"ion-input",11),x("ngModelChange",function(e){p(t);let o=l();return u(o.formData.new_password,e)||(o.formData.new_password=e),m(e)}),n(),C(9,oe,2,1,"ion-note",12),n(),a(10,"ion-col",3)(11,"ion-input",13),x("ngModelChange",function(e){p(t);let o=l();return u(o.formData.confirm_password,e)||(o.formData.confirm_password=e),m(e)}),n(),C(12,ne,2,1,"ion-note",12),n()(),a(13,"ion-row")(14,"ion-col",3)(15,"ion-button",10),f("click",function(){p(t);let e=l();return m(e.changePassword())}),d(16," Submit "),n()()()()()()}if(r&2){let t=l();s(8),h("ngModel",t.formData.new_password),s(),_("ngIf",t.errors.new_password),s(2),h("ngModel",t.formData.confirm_password),s(),_("ngIf",t.errors.confirm_password)}}var ge=(()=>{let c=class c{constructor(i,e,o,ee){this.userServ=i,this.alertCtrl=e,this.router=o,this.userService=ee,this.otpData={},this.otpCode={},this.showOtpInput=!1,this.otp="",this.expiryTime="",this.formData={},this.timer=0,this.resetpassword=!1,this.errors={}}ngOnInit(){}submit(){return w(this,null,function*(){if(!this.formData.mobile){yield this.showAlert("Mobile number is required.");return}if(!/^[6-9]\d{9}$/.test(this.formData.mobile)){yield this.showAlert("Please enter a valid 10-digit mobile number.");return}let e=yield this.userServ.checkMobileRegisterorNot(this.formData);switch(console.log(e),e.status){case 200:this.showOtpInput=!0,this.startOtpTimer(e.expiryTime),this.otpData={otp:e.generatedotp,mobile:e.mobile};break;case 403:this.showOtpInput=!1,this.router.navigate(["/signup"]);break;default:this.showAlert(e.err||"Login failed. Please try again.");break}})}verifyOtp(){return w(this,null,function*(){let i=String(this.otpCode||"").trim();if(i.length<4){yield this.showAlert("Please enter a valid OTP.");return}this.otpData.otp=i;let e=yield this.userServ.pwdOtpVerification(this.otpData);switch(this.formData.login_token=e.login_token,console.log(e),e.status){case 200:this.resetpassword=!0,this.showOtpInput=!1;break;case 403:this.showOtpInput=!1;break;default:this.showAlert(e.err||"verification failed. Please try again.");break}})}showAlert(i){return w(this,null,function*(){yield(yield this.alertCtrl.create({header:"Validation Error",message:i,buttons:["OK"]})).present()})}sanitizeMobile(i){let e=i.detail.value||"";e=e.replace(/[^0-9]/g,""),this.formData.mobile=e}startOtpTimer(i){let e=new Date(i).getTime(),o=Date.now();this.otpTimer=Math.max(Math.floor((e-o)/1e3),0),this.otpInterval&&clearInterval(this.otpInterval),this.otpInterval=setInterval(()=>{this.otpTimer>0?this.otpTimer--:clearInterval(this.otpInterval)},1e3)}changePassword(){return w(this,null,function*(){if(this.errors={},this.formData.new_password?this.formData.new_password.length<6&&(this.errors.new_password="Minimum 6 characters required"):this.errors.new_password="New password is required",this.formData.confirm_password?this.formData.new_password!==this.formData.confirm_password&&(this.errors.confirm_password="Passwords do not match"):this.errors.confirm_password="Confirm password is required",Object.keys(this.errors).length>0)return;let i={new_password:this.formData.new_password,confirm_password:this.formData.confirm_password,mobileno:this.formData.mobile},e=yield this.userService.resetpassword(i);switch(console.log(e),e.status){case 403:this.router.navigate(["/forgot-password"]);break;case 200:yield this.userServ.logout(),this.router.navigate(["/login"]),this.formData={};break}})}};c.\u0275fac=function(e){return new(e||c)(g(P),g($),g(V),g(P))},c.\u0275cmp=y({type:c,selectors:[["app-forgot-password"]],decls:7,vars:5,consts:[[3,"translucent"],[1,"ion-padding",3,"fullscreen"],[4,"ngIf"],["size","12"],["type","tel","pattern","[0-9]*","inputmode","numeric","minlength","10","maxlength","10","labelPlacement","floating","label","Enter register mobile no","fill","outline",3,"ngModelChange","ionChange","ngModel"],["expand","block",3,"click"],[1,"ion-text-center","ion-margin-bottom",2,"font-size","2rem"],[3,"ngModelChange","length","ngModel"],["size","12",1,"ion-text-center","ion-margin-top"],[1,"ion-text-center","ion-margin-top"],["expand","block",1,"ion-margin-top",3,"click"],["labelPlacement","floating","label","New Password","fill","outline","type","password",3,"ngModelChange","ngModel"],["color","danger",4,"ngIf"],["labelPlacement","floating","label","Confirm Password","fill","outline","type","password",3,"ngModelChange","ngModel"],["color","danger"]],template:function(e,o){e&1&&(a(0,"ion-header",0)(1,"ion-toolbar"),v(2,"ion-title"),n()(),a(3,"ion-content",1),C(4,te,10,1,"ion-card",2)(5,ie,20,5,"ion-card",2)(6,re,17,4,"ion-card",2),n()),e&2&&(_("translucent",!0),s(3),_("fullscreen",!0),s(),_("ngIf",!o.showOtpInput&&!o.resetpassword),s(),_("ngIf",o.showOtpInput&&!o.resetpassword),s(),_("ngIf",o.resetpassword))},dependencies:[L,q,H,U,G,X,Y,J,Q,N,z,j,B,T,S,A,O,E,F,W,K,R,k,Z],encapsulation:2});let r=c;return r})();export{ge as ForgotPasswordPage};
